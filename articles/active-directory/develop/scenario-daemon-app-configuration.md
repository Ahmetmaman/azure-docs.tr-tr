---
title: Web API 'Lerini çağıran Daemon uygulamalarını yapılandırma-Microsoft Identity platform | Mavisi
description: Web API 'Lerini (App Configuration) çağıran Daemon uygulamanız için kodu yapılandırmayı öğrenin
services: active-directory
author: jmprieur
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 10/30/2019
ms.author: jmprieur
ms.custom: aaddev, devx-track-python
ms.openlocfilehash: 567bd0a34c1989403f29ea5a52fad258c2ffe825
ms.sourcegitcommit: 7fe8df79526a0067be4651ce6fa96fa9d4f21355
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/06/2020
ms.locfileid: "87846165"
---
# <a name="daemon-app-that-calls-web-apis---code-configuration"></a>Web API 'Lerini çağıran Daemon uygulaması-kod yapılandırması

Web API 'Lerini çağıran Daemon uygulamanız için kodu yapılandırmayı öğrenin.

## <a name="msal-libraries-that-support-daemon-apps"></a>Daemon uygulamalarını destekleyen MSAL kitaplıkları

Bu Microsoft kitaplıkları, Daemon uygulamalarını destekler:

  MSAL kitaplığı | Açıklama
  ------------ | ----------
  ![MSAL.NET](media/sample-v2-code/logo_NET.png) <br/> MSAL.NET  | .NET Framework ve .NET Core platformları, Daemon uygulamalarının oluşturulması için desteklenir. (UWP, Xamarin. iOS ve Xamarin. Android desteklenmez çünkü bu platformlar ortak istemci uygulamaları oluşturmak için kullanılır.)
  ![Python](media/sample-v2-code/logo_python.png) <br/> MSAL Python | Python 'da Daemon uygulamaları için destek.
  ![Java](media/sample-v2-code/logo_java.png) <br/> MSAL Java | Java 'da Daemon uygulamaları için destek.

## <a name="configure-the-authority"></a>Yetkilendirmeyi yapılandırma

Daemon uygulamaları, temsilci izinleri yerine uygulama izinleri kullanır. Bu nedenle, desteklenen hesap türü herhangi bir kuruluş dizininde veya kişisel Microsoft hesabı (örneğin, Skype, Xbox, Outlook.com) bir hesap olamaz. Bir Microsoft kişisel hesabına yönelik bir Daemon uygulamasına izin vermek için kiracı yöneticisi yoktur. *Kuruluşumdaki hesaplar* veya *herhangi bir kuruluştaki hesaplar*' ı seçmeniz gerekir.

Bu nedenle, uygulama yapılandırmasında belirtilen yetki kiralanmalıdır (kiracı KIMLIĞI veya kuruluşunuzla ilişkili bir etki alanı adı belirterek).

ISV iseniz ve çok kiracılı bir araç sağlamak istiyorsanız, kullanabilirsiniz `organizations` . Ancak, müşterilere yönetici onayı verme hakkında da dikkat etmeniz gerektiğini unutmayın. Ayrıntılar için bkz. [Tüm kiracı için Izin isteme](v2-permissions-and-consent.md#requesting-consent-for-an-entire-tenant). Ayrıca, MSAL 'de Şu anda bir sınırlama vardır: `organizations` yalnızca istemci kimlik bilgileri bir uygulama gizli anahtarı (sertifika değil) olduğunda izin verilir.

## <a name="configure-and-instantiate-the-application"></a>Uygulamayı yapılandırma ve oluşturma

MSAL kitaplıklarında, istemci kimlik bilgileri (gizli veya sertifika) gizli istemci uygulaması oluşturma parametresi olarak geçirilir.

> [!IMPORTANT]
> Uygulamanız hizmet olarak çalışan bir konsol uygulaması olsa da, bir Daemon uygulaması ise, bir gizli istemci uygulaması olması gerekir.

### <a name="configuration-file"></a>Yapılandırma dosyası

Yapılandırma dosyası şunları tanımlar:

- Yetkili veya bulut örneği ve kiracı KIMLIĞI.
- Uygulama kaydından aldığınız istemci KIMLIĞI.
- Bir istemci parolası ya da bir sertifika.

# <a name="net"></a>[.NET](#tab/dotnet)

[.NET Core konsol Daemon](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2) örneğinden [appsettings.js](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2/blob/master/1-Call-MSGraph/daemon-console/appsettings.json) .

```json
{
  "Instance": "https://login.microsoftonline.com/{0}",
  "Tenant": "[Enter here the tenantID or domain name for your Azure AD tenant]",
  "ClientId": "[Enter here the ClientId for your application]",
  "ClientSecret": "[Enter here a client secret for your application]",
  "CertificateName": "[Or instead of client secret: Enter here the name of a certificate (from the user cert store) as registered with your application]"
}
```

Ya da a sağlarsınız `ClientSecret` `CertificateName` . Bu ayarlar dışlamalı.

# <a name="python"></a>[Python](#tab/python)

İstemci gizli dizileri ile gizli bir istemci oluşturduğunuzda, [Python Daemon](https://github.com/Azure-Samples/ms-identity-python-daemon) örneğindeki yapılandırma dosyasında [parameters.js](https://github.com/Azure-Samples/ms-identity-python-daemon/blob/master/1-Call-MsGraph-WithSecret/parameters.json) aşağıdaki gibidir:

```Json
{
  "authority": "https://login.microsoftonline.com/Enter_the_Tenant_Name_Here",
  "client_id": "your_client_id",
  "scope": [ "https://graph.microsoft.com/.default" ],
  "secret": "The secret generated by AAD during your confidential app registration",
  "endpoint": "https://graph.microsoft.com/v1.0/users"
}
```

Sertifikalarla gizli bir istemci oluşturduğunuzda, [Python Daemon](https://github.com/Azure-Samples/ms-identity-python-daemon) örneğindeki yapılandırma dosyası [parameters.js](https://github.com/Azure-Samples/ms-identity-python-daemon/blob/master/2-Call-MsGraph-WithCertificate/parameters.json) aşağıdaki gibidir:

```Json
{
  "authority": "https://login.microsoftonline.com/Enter_the_Tenant_Name_Here",
  "client_id": "your_client_id",
  "scope": [ "https://graph.microsoft.com/.default" ],
  "thumbprint": "790E... The thumbprint generated by AAD when you upload your public cert",
  "private_key_file": "server.pem",
  "endpoint": "https://graph.microsoft.com/v1.0/users"
}
```

# <a name="java"></a>[Java](#tab/java)

```Java
 private final static String CLIENT_ID = "";
 private final static String AUTHORITY = "https://login.microsoftonline.com/<tenant>/";
 private final static String CLIENT_SECRET = "";
 private final static Set<String> SCOPE = Collections.singleton("https://graph.microsoft.com/.default");
```

---

### <a name="instantiate-the-msal-application"></a>MSAL uygulamasını oluşturma

MSAL uygulamasını oluşturmak için, MSAL paketini (dile bağlı olarak) eklemeniz, başvurmanız veya içeri aktarmanız gerekir.

Oluşturma, istemci gizli dizileri veya sertifikalar (ya da gelişmiş bir senaryo olarak imzalanmış onaylar olarak) kullanıp kullanmayacağınızı bağlı olarak değişir.

#### <a name="reference-the-package"></a>Pakete başvur

Uygulama kodunuzda MSAL paketine başvurun.

# <a name="net"></a>[.NET](#tab/dotnet)

Uygulamanıza [Microsoft. ıdentityclient](https://www.nuget.org/packages/Microsoft.Identity.Client) NuGet paketini ekleyin.
MSAL.NET ' de, gizli istemci uygulaması arabirim tarafından temsil edilir `IConfidentialClientApplication` .
Kaynak kodundaki MSAL.NET ad alanını kullanın.

```csharp
using Microsoft.Identity.Client;
IConfidentialClientApplication app;
```

# <a name="python"></a>[Python](#tab/python)

```python
import msal
```

# <a name="java"></a>[Java](#tab/java)

```java
import com.microsoft.aad.msal4j.ClientCredentialFactory;
import com.microsoft.aad.msal4j.ClientCredentialParameters;
import com.microsoft.aad.msal4j.ConfidentialClientApplication;
import com.microsoft.aad.msal4j.IAuthenticationResult;
import com.microsoft.aad.msal4j.IClientCredential;
import com.microsoft.aad.msal4j.MsalException;
import com.microsoft.aad.msal4j.SilentParameters;
```

---

#### <a name="instantiate-the-confidential-client-application-with-a-client-secret"></a>Gizli istemci uygulamasını bir istemci gizli anahtarı ile oluşturun

Gizli istemci uygulamasını bir istemci gizli dizisi ile başlatmak için kod aşağıda verilmiştir:

# <a name="net"></a>[.NET](#tab/dotnet)

```csharp
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
           .WithClientSecret(config.ClientSecret)
           .WithAuthority(new Uri(config.Authority))
           .Build();
```

# <a name="python"></a>[Python](#tab/python)

```Python
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential=config["secret"],
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

# <a name="java"></a>[Java](#tab/java)

```Java
IClientCredential credential = ClientCredentialFactory.createFromSecret(CLIENT_SECRET);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

---

#### <a name="instantiate-the-confidential-client-application-with-a-client-certificate"></a>İstemci sertifikası ile gizli istemci uygulaması örneğini oluşturma

Sertifika ile bir uygulama oluşturmak için aşağıdaki kod aşağıda verilmiştir:

# <a name="net"></a>[.NET](#tab/dotnet)

```csharp
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
    .WithCertificate(certificate)
    .WithAuthority(new Uri(config.Authority))
    .Build();
```

# <a name="python"></a>[Python](#tab/python)

```Python
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential={"thumbprint": config["thumbprint"], "private_key": open(config['private_key_file']).read()},
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

# <a name="java"></a>[Java](#tab/java)

MSAL Java 'da, sertifikalarla gizli istemci uygulaması örneğini oluşturmak için iki oluşturucular vardır:

```Java

InputStream pkcs12Certificate = ... ; /* Containing PCKS12-formatted certificate*/
string certificatePassword = ... ;    /* Contains the password to access the certificate */

IClientCredential credential = ClientCredentialFactory.createFromCertificate(pkcs12Certificate, certificatePassword);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

veya

```Java
PrivateKey key = getPrivateKey(); /* RSA private key to sign the assertion */
X509Certificate publicCertificate = getPublicCertificate(); /* x509 public certificate used as a thumbprint */

IClientCredential credential = ClientCredentialFactory.createFromCertificate(key, publicCertificate);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

---

#### <a name="advanced-scenario-instantiate-the-confidential-client-application-with-client-assertions"></a>Gelişmiş senaryo: istemci onaylamaları ile gizli istemci uygulaması örneğini oluşturma

# <a name="net"></a>[.NET](#tab/dotnet)

Gizli istemci uygulaması, bir istemci parolası ya da bir sertifika yerine, istemci onayları kullanarak kimliğini kanıtlayabilirler.

MSAL.NET, gizli istemci uygulamasına imzalı onaylar sağlamak için iki yönteme sahiptir:

- `.WithClientAssertion()`
- `.WithClientClaims()`

Kullandığınızda `WithClientAssertion` , imzalı BIR JWT sağlamanız gerekir. Bu gelişmiş senaryo, [istemci onaylamaları](msal-net-client-assertions.md)hakkında ayrıntılıdır.

```csharp
string signedClientAssertion = ComputeAssertion();
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
                                          .WithClientAssertion(signedClientAssertion)
                                          .Build();
```

Kullandığınızda `WithClientClaims` , msal.net, Azure AD tarafından beklenen talepleri ve ayrıca göndermek istediğiniz ek istemci taleplerini içeren imzalı bir onaylama işlemi oluşturacaktır.
Bu kod, bunun nasıl yapılacağını gösterir:

```csharp
string ipAddress = "192.168.1.2";
var claims = new Dictionary<string, string> { { "client_ip", ipAddress } };
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
                                          .WithAuthority(new Uri(config.Authority))
                                          .WithClientClaims(certificate, claims)
                                          .Build();```
```

Daha ayrıntılı bilgi için bkz. [istemci onayları](msal-net-client-assertions.md).

# <a name="python"></a>[Python](#tab/python)

MSAL Python 'da, bu özel anahtar tarafından imzalanacak talepleri kullanarak istemci talepleri sağlayabilirsiniz `ConfidentialClientApplication` .

```Python
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential={"thumbprint": config["thumbprint"], "private_key": open(config['private_key_file']).read()},
    client_claims = {"client_ip": "x.x.x.x"}
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

Ayrıntılar için bkz. MSAL Python başvuru belgeleri [ConfidentialClientApplication](https://msal-python.readthedocs.io/en/latest/#msal.ClientApplication.__init__).

# <a name="java"></a>[Java](#tab/java)

```Java
IClientCredential credential = ClientCredentialFactory.createFromClientAssertion(assertion);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

---

## <a name="next-steps"></a>Sonraki adımlar

# <a name="net"></a>[.NET](#tab/dotnet)

> [!div class="nextstepaction"]
> [Daemon uygulaması-uygulama belirteçleri alınıyor](https://docs.microsoft.com/azure/active-directory/develop/scenario-daemon-acquire-token?tabs=dotnet)

# <a name="python"></a>[Python](#tab/python)

> [!div class="nextstepaction"]
> [Daemon uygulaması-uygulama belirteçleri alınıyor](https://docs.microsoft.com/azure/active-directory/develop/scenario-daemon-acquire-token?tabs=python)

# <a name="java"></a>[Java](#tab/java)

> [!div class="nextstepaction"]
> [Daemon uygulaması-uygulama belirteçleri alınıyor](https://docs.microsoft.com/azure/active-directory/develop/scenario-daemon-acquire-token?tabs=java)

---
