---
title: Web API'lerini arayan daemon uygulamalarını yapılandırın - Microsoft kimlik platformu | Azure
description: Web API'lerini (uygulama yapılandırması) çağıran daemon uygulamanızın kodunu nasıl yapılandırıştırmayı öğrenin
services: active-directory
author: jmprieur
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 10/30/2019
ms.author: jmprieur
ms.custom: aaddev
ms.openlocfilehash: ead39343cca9943ba55d66509bd9917402efb8cf
ms.sourcegitcommit: af1cbaaa4f0faa53f91fbde4d6009ffb7662f7eb
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/22/2020
ms.locfileid: "81868982"
---
# <a name="daemon-app-that-calls-web-apis---code-configuration"></a>Web API'leri çağıran Daemon uygulaması - kod yapılandırması

Web API'lerini çağıran daemon uygulamanızın kodunu nasıl yapılandırıştırığınızı öğrenin.

## <a name="msal-libraries-that-support-daemon-apps"></a>Daemon uygulamalarını destekleyen MSAL kütüphaneleri

Bu Microsoft kitaplıkları daemon uygulamalarını destekler:

  MSAL kütüphanesi | Açıklama
  ------------ | ----------
  ![MSAL.NET](media/sample-v2-code/logo_NET.png) <br/> MSAL.NET  | .NET Framework ve .NET Core platformları daemon uygulamaları oluşturmak için desteklenir. (UWP, Xamarin.iOS ve Xamarin.Android desteklenmez çünkü bu platformlar genel istemci uygulamaları oluşturmak için kullanılır.)
  ![Python](media/sample-v2-code/logo_python.png) <br/> MSAL Piton | Python'da daemon uygulamaları için destek.
  ![Java](media/sample-v2-code/logo_java.png) <br/> MSAL Java | Java'da daemon uygulamaları için destek.

## <a name="configure-the-authority"></a>Yetkiyi yapılandırma

Daemon uygulamaları, yetkin izinler yerine uygulama izinlerini kullanır. Bu nedenle desteklenen hesap türü herhangi bir kuruluş dizininde veya herhangi bir kişisel Microsoft hesabında (örneğin, Skype, Xbox, Outlook.com) bir hesap olamaz. Microsoft kişisel hesabı için daemon uygulamasına onay verecek kiracı yöneticisi yoktur. *Kuruluşumdaki hesapları* veya *herhangi bir kuruluştaki hesapları*seçmeniz gerekir.

Bu nedenle, uygulama yapılandırmasında belirtilen yetkinin kiracı olması gerekir (kiracı kimliği veya kuruluşunuzla ilişkili bir etki alanı adı belirtilmesi).

ISV kullanıyorsanız ve çok kiracılı bir araç sağlamak `organizations`istiyorsanız, bunu kullanabilirsiniz. Ancak, müşterilerinize yönetici onayı nasıl vereceğiniz konusunda da açıklama yapmanız gerektiğini unutmayın. Ayrıntılar için, [tüm kiracı için onay isteme 'ye](v2-permissions-and-consent.md#requesting-consent-for-an-entire-tenant)bakın. Ayrıca, şu anda MSAL'da `organizations` bir sınırlama vardır: yalnızca istemci kimlik bilgileri bir uygulama sırrı olduğunda (sertifika değil) izin verilir.

## <a name="configure-and-instantiate-the-application"></a>Uygulamayı yapılandırma ve anında

MSAL kitaplıklarında, istemci kimlik bilgileri (gizli veya sertifika) gizli istemci uygulaması yapısının bir parametresi olarak geçirilir.

> [!IMPORTANT]
> Uygulamanız bir hizmet olarak çalışan bir konsol uygulaması olsa bile, bu bir daemon uygulaması ysa, gizli bir istemci uygulaması olması gerekir.

### <a name="configuration-file"></a>Yapılandırma dosyası

Yapılandırma dosyası tanımlar:

- Yetkili makam veya bulut örneği ve kiracı kimliği.
- Başvuru kaydından aldığınız istemci kimliği.
- Ya bir istemci sırrı ya da bir sertifika.

# <a name="net"></a>[.NET](#tab/dotnet)

[.NET Core konsol daemon](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2) örnekappsettings.json. [appsettings.json](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2/blob/master/1-Call-MSGraph/daemon-console/appsettings.json)

```json
{
  "Instance": "https://login.microsoftonline.com/{0}",
  "Tenant": "[Enter here the tenantID or domain name for your Azure AD tenant]",
  "ClientId": "[Enter here the ClientId for your application]",
  "ClientSecret": "[Enter here a client secret for your application]",
  "CertificateName": "[Or instead of client secret: Enter here the name of a certificate (from the user cert store) as registered with your application]"
}
```

Ya bir `ClientSecret` ya `CertificateName`da bir . Bu ayarlar özeldir.

# <a name="python"></a>[Python](#tab/python)

İstemci sırları içeren gizli bir istemci oluşturduğunuzda, [Python daemon](https://github.com/Azure-Samples/ms-identity-python-daemon) örneğindeki [parameters.json](https://github.com/Azure-Samples/ms-identity-python-daemon/blob/master/1-Call-MsGraph-WithSecret/parameters.json) config dosyası aşağıdaki gibidir:

```Json
{
  "authority": "https://login.microsoftonline.com/Enter_the_Tenant_Name_Here",
  "client_id": "your_client_id",
  "scope": [ "https://graph.microsoft.com/.default" ],
  "secret": "The secret generated by AAD during your confidential app registration",
  "endpoint": "https://graph.microsoft.com/v1.0/users"
}
```

Sertifikalı gizli bir istemci oluşturduğunuzda, [Python daemon](https://github.com/Azure-Samples/ms-identity-python-daemon) örneğindeki [parameters.json](https://github.com/Azure-Samples/ms-identity-python-daemon/blob/master/2-Call-MsGraph-WithCertificate/parameters.json) config dosyası aşağıdaki gibidir:

```Json
{
  "authority": "https://login.microsoftonline.com/Enter_the_Tenant_Name_Here",
  "client_id": "your_client_id",
  "scope": [ "https://graph.microsoft.com/.default" ],
  "thumbprint": "790E... The thumbprint generated by AAD when you upload your public cert",
  "private_key_file": "server.pem",
  "endpoint": "https://graph.microsoft.com/v1.0/users"
}
```

# <a name="java"></a>[Java](#tab/java)

```Java
 private final static String CLIENT_ID = "";
 private final static String AUTHORITY = "https://login.microsoftonline.com/<tenant>/";
 private final static String CLIENT_SECRET = "";
 private final static Set<String> SCOPE = Collections.singleton("https://graph.microsoft.com/.default");
```

---

### <a name="instantiate-the-msal-application"></a>MSAL uygulamasını anında

MSAL uygulamasını anında duruma getirmek için MSAL paketini eklemeniz, başvurmanız veya içe aktarmanız gerekir (dile bağlı olarak).

Müşteri sırlarını veya sertifikalarını (veya gelişmiş bir senaryo olarak imzalı iddiaları) kullanıp kullanmadığınıza bağlı olarak yapı farklıdır.

#### <a name="reference-the-package"></a>Pakete başvurun

Uygulama kodunuzdaki MSAL paketine başvurun.

# <a name="net"></a>[.NET](#tab/dotnet)

[Microsoft.IdentityClient](https://www.nuget.org/packages/Microsoft.Identity.Client) NuGet paketini uygulamanıza ekleyin.
MSAL.NET, gizli istemci uygulaması `IConfidentialClientApplication` arabirimi tarafından temsil edilir.
Kaynak kodundaki MSAL.NET ad alanını kullanın.

```csharp
using Microsoft.Identity.Client;
IConfidentialClientApplication app;
```

# <a name="python"></a>[Python](#tab/python)

```python
import msal
```

# <a name="java"></a>[Java](#tab/java)

```java
import com.microsoft.aad.msal4j.ClientCredentialFactory;
import com.microsoft.aad.msal4j.ClientCredentialParameters;
import com.microsoft.aad.msal4j.ConfidentialClientApplication;
import com.microsoft.aad.msal4j.IAuthenticationResult;
import com.microsoft.aad.msal4j.IClientCredential;
import com.microsoft.aad.msal4j.MsalException;
import com.microsoft.aad.msal4j.SilentParameters;
```

---

#### <a name="instantiate-the-confidential-client-application-with-a-client-secret"></a>Gizli istemci uygulamasını bir istemci sırrıyla anında

Gizli istemci uygulamasını bir istemci sırrıyla anında algılamanın kodu aşağıda veda edebilirsiniz:

# <a name="net"></a>[.NET](#tab/dotnet)

```csharp
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
           .WithClientSecret(config.ClientSecret)
           .WithAuthority(new Uri(config.Authority))
           .Build();
```

# <a name="python"></a>[Python](#tab/python)

```Python
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential=config["secret"],
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

# <a name="java"></a>[Java](#tab/java)

```Java
IClientCredential credential = ClientCredentialFactory.createFromSecret(CLIENT_SECRET);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

---

#### <a name="instantiate-the-confidential-client-application-with-a-client-certificate"></a>Müşteri sertifikası ile gizli istemci uygulamasını anında

Sertifikalı bir uygulama oluşturmak için kod aşağıda vereb:

# <a name="net"></a>[.NET](#tab/dotnet)

```csharp
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
    .WithCertificate(certificate)
    .WithAuthority(new Uri(config.Authority))
    .Build();
```

# <a name="python"></a>[Python](#tab/python)

```Python
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential={"thumbprint": config["thumbprint"], "private_key": open(config['private_key_file']).read()},
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

# <a name="java"></a>[Java](#tab/java)

MSAL Java'da, gizli istemci uygulamasını sertifikalarla anında hale getirmek için iki oluşturucu vardır:

```Java

InputStream pkcs12Certificate = ... ; /* Containing PCKS12-formatted certificate*/
string certificatePassword = ... ;    /* Contains the password to access the certificate */

IClientCredential credential = ClientCredentialFactory.createFromCertificate(pkcs12Certificate, certificatePassword);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

or

```Java
PrivateKey key = getPrivateKey(); /* RSA private key to sign the assertion */
X509Certificate publicCertificate = getPublicCertificate(); /* x509 public certificate used as a thumbprint */

IClientCredential credential = ClientCredentialFactory.createFromCertificate(key, publicCertificate);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

---

#### <a name="advanced-scenario-instantiate-the-confidential-client-application-with-client-assertions"></a>Gelişmiş senaryo: Gizli istemci uygulamasını istemci iddialarıyla anında

# <a name="net"></a>[.NET](#tab/dotnet)

Gizli istemci uygulaması, istemci sırrı veya sertifika yerine, istemci iddialarını kullanarak kimliğini de kanıtlayabilir.

MSAL.NET gizli istemci uygulamasına imzalı iddialar sağlamak için iki yöntem vardır:

- `.WithClientAssertion()`
- `.WithClientClaims()`

`WithClientAssertion`Kullandığınızda, imzalı bir JWT sağlamanız gerekir. Bu gelişmiş senaryo [İstemci iddialarında](msal-net-client-assertions.md)ayrıntılı olarak açıklanır.

```csharp
string signedClientAssertion = ComputeAssertion();
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
                                          .WithClientAssertion(signedClientAssertion)
                                          .Build();
```

Kullandığınızda, `WithClientClaims`MSAL.NET Azure AD tarafından beklenen talepleri ve göndermek istediğiniz ek istemci taleplerini içeren imzalı bir iddia üretir.
Bu kod, bunun nasıl yapılacağını gösterir:

```csharp
string ipAddress = "192.168.1.2";
var claims = new Dictionary<string, string> { { "client_ip", ipAddress } };
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
                                          .WithAuthority(new Uri(config.Authority))
                                          .WithClientClaims(certificate, claims)
                                          .Build();```
```

Yine, ayrıntılar [için, Bkz. İstemci iddiaları.](msal-net-client-assertions.md)

# <a name="python"></a>[Python](#tab/python)

MSAL Python'da, bu `ConfidentialClientApplication`özel anahtar tarafından imzalanacak talepleri kullanarak istemci taleplerini sağlayabilirsiniz.

```Python
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential={"thumbprint": config["thumbprint"], "private_key": open(config['private_key_file']).read()},
    client_claims = {"client_ip": "x.x.x.x"}
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

Ayrıntılar için [ConfidentialClientApplication](https://msal-python.readthedocs.io/en/latest/#msal.ClientApplication.__init__)için MSAL Python başvuru belgelerine bakın.

# <a name="java"></a>[Java](#tab/java)

```Java
IClientCredential credential = ClientCredentialFactory.createFromClientAssertion(assertion);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

---

## <a name="next-steps"></a>Sonraki adımlar

# <a name="net"></a>[.NET](#tab/dotnet)

> [!div class="nextstepaction"]
> [Daemon uygulaması - uygulama için belirteçleri edinme](https://docs.microsoft.com/azure/active-directory/develop/scenario-daemon-acquire-token?tabs=dotnet)

# <a name="python"></a>[Python](#tab/python)

> [!div class="nextstepaction"]
> [Daemon uygulaması - uygulama için belirteçleri edinme](https://docs.microsoft.com/azure/active-directory/develop/scenario-daemon-acquire-token?tabs=python)

# <a name="java"></a>[Java](#tab/java)

> [!div class="nextstepaction"]
> [Daemon uygulaması - uygulama için belirteçleri edinme](https://docs.microsoft.com/azure/active-directory/develop/scenario-daemon-acquire-token?tabs=java)

---
